<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Galaxy Requiem</title>
<style>
html,body{
  margin:0; padding:0;
  background:#000;
  overflow:hidden;
}
canvas{display:block;}
.hint{
  position:fixed;
  bottom:24px; left:50%;
  transform:translateX(-50%);
  color:rgba(255,255,255,.65);
  font:12px system-ui;
  letter-spacing:.15em;
}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div class="hint">CLICK TO INITIATE HYPERDRIVE</div>

<script>
/* ===============================
   GALAXY REQUIEM
   cinematic opening experience
   =============================== */

const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
function resize(){
  const dpr=Math.min(2,devicePixelRatio||1);
  canvas.width=innerWidth*dpr;
  canvas.height=innerHeight*dpr;
  canvas.style.width=innerWidth+"px";
  canvas.style.height=innerHeight+"px";
  ctx.setTransform(1,0,0,1,0,0);
  ctx.scale(dpr,dpr);
}
addEventListener("resize",resize);
resize();

const CX=()=>innerWidth/2;
const CY=()=>innerHeight/2;

/* ===== audio (cinematic low drone) ===== */
let audioCtx, osc, gain, started=false;
function initAudio(){
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  osc=audioCtx.createOscillator();
  gain=audioCtx.createGain();
  osc.type="sine";
  osc.frequency.value=32; // deep space drone
  gain.gain.value=0.0;
  osc.connect(gain).connect(audioCtx.destination);
  osc.start();
  gain.gain.linearRampToValueAtTime(0.15,audioCtx.currentTime+4);
}
addEventListener("click",()=>{
  if(!started){
    initAudio();
    document.querySelector(".hint").remove();
    started=true;
  }
});

/* ===== galaxy ===== */
const STARS=6000;
const galaxy=[];
for(let i=0;i<STARS;i++){
  const r=Math.pow(Math.random(),0.35);
  galaxy.push({
    r,
    a:r*10+Math.random()*0.8,
    z:Math.random(),
    s:0.6+Math.random()*1.8,
    h:190+Math.random()*60
  });
}

/* ===== warp stars ===== */
const WARP=1400;
const warp=[];
function reset(w){
  w.x=(Math.random()-0.5)*2;
  w.y=(Math.random()-0.5)*2;
  w.z=Math.random();
}
for(let i=0;i<WARP;i++){
  const w={};
  reset(w);
  warp.push(w);
}

let t=0;

function draw(){
  ctx.fillStyle="rgba(0,0,0,0.25)";
  ctx.fillRect(0,0,innerWidth,innerHeight);

  // timeline
  const time=t%36;
  const zoomIn=Math.min(1,time/10);
  const warpOn=Math.max(0,Math.min(1,(time-9)/6));
  const zoomOut=Math.max(0,Math.min(1,(time-22)/10));

  const zoom=1+zoomIn*5-zoomOut*4;

  if(started){
    osc.frequency.setTargetAtTime(
      32+warpOn*40,
      audioCtx.currentTime,
      0.8
    );
  }

  ctx.save();
  ctx.translate(CX(),CY());
  ctx.scale(zoom,zoom);

  // galaxy
  galaxy.forEach(s=>{
    const a=s.a+t*0.04;
    const r=s.r*Math.min(innerWidth,innerHeight)*0.48;
    let x=Math.cos(a)*r;
    let y=Math.sin(a)*r;

    const d=Math.sqrt(x*x+y*y)+1;
    const lens=1+warpOn/(d*0.02);
    x*=lens; y*=lens;

    ctx.fillStyle=`hsla(${s.h},100%,70%,${1-warpOn})`;
    ctx.fillRect(x,y,s.s,s.s);
  });

  // core glow
  const core=ctx.createRadialGradient(0,0,0,0,0,120);
  core.addColorStop(0,"rgba(255,255,255,0.35)");
  core.addColorStop(0.4,"rgba(120,170,255,0.18)");
  core.addColorStop(1,"rgba(0,0,0,0)");
  ctx.fillStyle=core;
  ctx.beginPath();
  ctx.arc(0,0,120,0,Math.PI*2);
  ctx.fill();

  ctx.restore();

  // warp
  if(warpOn>0){
    warp.forEach(w=>{
      w.z-=0.02*warpOn;
      if(w.z<0.02) reset(w);
      const x=CX()+w.x/w.z*CX();
      const y=CY()+w.y/w.z*CY();
      const len=(1-w.z)*25*warpOn;
      ctx.strokeStyle="rgba(255,255,255,0.8)";
      ctx.beginPath();
      ctx.moveTo(x,y);
      ctx.lineTo(x-w.x*len,y-w.y*len);
      ctx.stroke();
    });
  }

  // title reveal
  if(time>3 && time<9){
    ctx.save();
    ctx.fillStyle="rgba(255,255,255,0.6)";
    ctx.font="48px serif";
    ctx.textAlign="center";
    ctx.fillText("GALAXY REQUIEM",CX(),CY()+innerHeight*0.28);
    ctx.restore();
  }

  t+=0.016;
  requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
